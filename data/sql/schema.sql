CREATE TABLE contest (id BIGINT AUTO_INCREMENT, title TEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, slug VARCHAR(255), UNIQUE INDEX sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE image (id BIGINT AUTO_INCREMENT, url TEXT NOT NULL, vote_sum BIGINT DEFAULT 0 NOT NULL, vote_count BIGINT DEFAULT 0 NOT NULL, vote_avg BIGINT DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE vote (id BIGINT AUTO_INCREMENT, image_id BIGINT NOT NULL, value BIGINT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX image_id_idx (image_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE vote ADD CONSTRAINT vote_image_id_image_id FOREIGN KEY (image_id) REFERENCES image(id) ON DELETE CASCADE;
